"use strict";var EMAIL="nikolay.hnatovskyi@gmail.com",commentsCount=0,isEditModeEnabled=!1,currentUser={name:"Kurt Thompson",avatar:"http://api.randomuser.me/portraits/thumb/men/69.jpg"};function getCommentsList(n,e){var t="http://frontend-test.pingbull.com/pages/"+EMAIL+"/comments";void 0!==n&&void 0!==e?t+="?count="+n+"&offset="+e:void 0!==n?t+="?count="+n:void 0!==e&&(t+="?offset="+e);var a=new XMLHttpRequest;a.open("GET",t,!0),a.onload=function(){var n=JSON.parse(a.responseText);4==a.readyState&&"200"==a.status?renderCommentList(n):console.error(n)},a.send(null)}function getSingleComment(n){var e="http://frontend-test.pingbull.com/pages/"+EMAIL+"/comments/",t=new XMLHttpRequest;t.open("GET",e+n,!0),t.onload=function(){var n=JSON.parse(t.responseText);4==t.readyState&&"200"==t.status?console.log(n):console.error(n)},t.send(null)}function newComment(n,e){var t="http://frontend-test.pingbull.com/pages/"+EMAIL+"/comments";void 0!==n&&void 0!==e?t+="?content="+n+"&parent="+e:void 0!==n?t+="?content="+n:void 0===n&&console.log("Please, enter the message!");var a=new XMLHttpRequest;a.open("POST",t,!0),a.setRequestHeader("Content-type","application/json; charset=utf-8"),a.onload=function(){var n=JSON.parse(a.responseText);4==a.readyState&&"201"==a.status?console.log(n,t):console.error(n)},a.send(null)}function editComment(n,e){var t="http://frontend-test.pingbull.com/pages/"+EMAIL+"/comments/"+n;if(void 0!==e){t+="?content="+e;var a=new XMLHttpRequest;a.open("PUT",t,!0),a.setRequestHeader("Content-type","application/json; charset=utf-8"),a.onload=function(){var n=JSON.parse(a.responseText);4==a.readyState&&"200"==a.status?console.log(n):console.error(n)},a.send(null)}}function deleteComment(n){var e="http://frontend-test.pingbull.com/pages/"+EMAIL+"/comments/"+n,t=new XMLHttpRequest;t.open("DELETE",e,!0),t.send(null)}function renderCommentList(n){var t="",e=Array.from(n),a=/[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])/,o=/([01]?[0-9]|2[0-3]):[0-5][0-9]/;e.forEach(function(e){commentsCount++,t+='\n        <div class="comment">\n            <div class="avatar">\n                <img src="'+e.author.avatar+'" alt="avatar">\n            </div>\n            <div class="comment__body">\n                <div class="comment__meta">\n                    <span class="comment__author">\n                        '+e.author.name+'\n                    </span>\n                    <span class="comment__date">\n                        <i class="fa fa-clock-o" aria-hidden="true"></i>\n                        <span>'+e.created_at.match(a)[0]+"</span> at \n                        <span>"+e.created_at.match(o)[0]+'</span>\n                    </span>\n                </div>\n                <div class="comment__text">\n                    '+e.content+'\n                </div>\n                <div class="comment__actions">\n                    <button onclick="toggleCommentForm(event); isEditMode(event);">\n                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit\n                    </button>\n                    <button onclick="deleteCurrentComment(event, '+e.id+')">\n                        <i class="fa fa-times" aria-hidden="true"></i> Delete\n                    </button>\n                    <button onclick="toggleCommentForm(event)">\n                        <i class="fa fa-reply" aria-hidden="true"></i>Reply\n                    </button>\n                </div>\n                <div class="comment__form">\n                    <div class="comment__form-header">\n                        <span class="reply-to"><i class="fa fa-reply" aria-hidden="true"></i> '+e.author.name+'</span>\n                        <button class="cancel" onclick="toggleCommentForm(event)">\n                            <i class="fa fa-times" aria-hidden="true"></i> Cancel\n                        </button>\n                    </div>\n                    <form action="">\n                        <textarea placeholder="Your Message" name="" id="" cols="30" rows="6"></textarea>\n                        <input class="btn" type="button" value="Send" onclick="formButtonAction(event, '+e.id+', \'answer\')">\n                    </form>\n                </div>\n                <div class="comment__answers">',e.children.forEach(function(n){t+='\n                    <div class="comment comment_children">\n                        <div class="avatar">\n                            <img src="'+n.author.avatar+'" alt="avatar">\n                        </div>\n                        <div class="comment__body">\n                            <div class="comment__meta">\n                                <span class="comment__author">\n                                    '+n.author.name+'\n                                </span>\n                                <span class="comment__reply-to">\n                                    <i class="fa fa-reply" aria-hidden="true"></i> '+e.author.name+'\n                                </span>\n                                <span class="comment__date">\n                                    <i class="fa fa-clock-o" aria-hidden="true"></i>\n                                    <span>'+n.created_at.match(a)[0]+"</span> at \n                                    <span>"+n.created_at.match(o)[0]+'</span>\n                                </span>\n                            </div>\n                            <div class="comment__text">\n                                '+n.content+"\n                            </div>\n                        </div>\n                    </div>"}),t+="</div>\n            </div>\n        </div>"}),document.getElementById("comment-list").innerHTML+=t}function toggleCommentForm(n){isEditModeEnabled=!1;var e=$(n.target),t=e.parents(".comment__body").find(".comment__form"),a=e.parents(".comment__body").find("textarea");t.hasClass("comment__form_opened")?(t.removeClass("comment__form_opened"),a.val("")):t.addClass("comment__form_opened")}function sendComment(n,e,t){var a=$(n.target).parent("form").find("textarea"),o=a.val();switch(t){case"answer":newComment(o,e),showNewAnswer(n),toggleCommentForm(n),a.val("");break;case"comment":newComment(o),setTimeout(function(){showNewComment(n),a.val("")},500)}isEditModeEnabled=!1}function deleteCurrentComment(n,e){$(n.target).parents(".comment").remove(),deleteComment(e)}function loadMoreComments(n){var e=5;isFirefox()&&(e=0);var t=$(n.target);getCommentsList(e,commentsCount);var a="http://frontend-test.pingbull.com/pages/"+EMAIL+"/comments?count=99999",o=new XMLHttpRequest;o.open("GET",a,!1),o.onload=function(){var n=JSON.parse(o.responseText);4==o.readyState&&"200"==o.status?commentsCount>=n.length-e&&t.parent(".load-more").css("visibility","hidden"):console.error(n)},o.send(null)}function editCurrentComment(n,e){editComment(e,$(n.target).parent("form").find("textarea").val())}function isEditMode(n){isEditModeEnabled=!0;var e=$(n.target),t=e.parents(".comment__body").find("textarea"),a=e.parents(".comment__body").find(".comment__text").first().text();t.val(a.trim())}function formButtonAction(n,e,t){if(isEditModeEnabled){editCurrentComment(n,e);var a=$(n.target),o=a.parents(".comment__body").find(".comment__text").first(),r=a.parents(".comment__body").find("textarea");o.text(r.val()),r.val("")}else sendComment(n,e,t)}function showNewAnswer(n){var e=$(n.target),t=e.parent("form").find("textarea").val(),a=e.parents(".comment__body").find(".comment__answers"),o=e.parents(".comment:not(.comment_children)").find(".comment__meta .comment__author").first().text(),r='<div class="comment comment_children">\n        <div class="avatar">\n            <img src="'+currentUser.avatar+'" alt="avatar">\n        </div>\n        <div class="comment__body">\n            <div class="comment__meta">\n                <span class="comment__author">\n                    '+currentUser.name+'\n                </span>\n                <span class="comment__reply-to">\n                    <i class="fa fa-reply" aria-hidden="true"></i> '+o+'\n                </span>\n                <span class="comment__date">\n                    <i class="fa fa-clock-o" aria-hidden="true"></i>\n                    <span>'+getCurrentDate()+"</span> at \n                    <span>"+getCurrentTime()+'</span>\n                </span>\n            </div>\n            <div class="comment__text">\n                '+t+"\n            </div>\n        </div>\n    </div>";a.append(r)}function showNewComment(n){var e="",t=$(n.target).parent("form").find("textarea").val(),a="http://frontend-test.pingbull.com/pages/"+EMAIL+"/comments?count=1",o=new XMLHttpRequest;o.open("GET",a,!0),o.onload=function(){var n=JSON.parse(o.responseText);4==o.readyState&&"200"==o.status?(console.log(n),e='\n                <div class="comment">\n                    <div class="avatar">\n                        <img src="'+currentUser.avatar+'" alt="avatar">\n                    </div>\n                    <div class="comment__body">\n                        <div class="comment__meta">\n                            <span class="comment__author">\n                                '+currentUser.name+'\n                            </span>\n                            <span class="comment__date">\n                                <i class="fa fa-clock-o" aria-hidden="true"></i>\n                                <span>'+getCurrentDate()+"</span> at \n                                <span>"+getCurrentTime()+'</span>\n                            </span>\n                        </div>\n                        <div class="comment__text">\n                            '+t+'\n                        </div>\n                        <div class="comment__actions">\n                            <button onclick="toggleCommentForm(event); isEditMode(event);">\n                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit\n                            </button>\n                            <button onclick="deleteCurrentComment(event, '+n[0].id+')">\n                                <i class="fa fa-times" aria-hidden="true"></i> Delete\n                            </button>\n                            <button onclick="toggleCommentForm(event)">\n                                <i class="fa fa-reply" aria-hidden="true"></i>Reply\n                            </button>\n                        </div>\n                        <div class="comment__form">\n                            <div class="comment__form-header">\n                                <span class="reply-to"><i class="fa fa-reply" aria-hidden="true"></i> Kurt Thompson</span>\n                                <button class="cancel" onclick="toggleCommentForm(event)">\n                                    <i class="fa fa-times" aria-hidden="true"></i> Cancel\n                                </button>\n                            </div>\n                            <form action="">\n                                <textarea placeholder="Your Message" name="" id="" cols="30" rows="6"></textarea>\n                                <input class="btn" type="button" value="Send" onclick="formButtonAction(event, '+n[0].id+', \'answer\')">\n                            </form>\n                        </div>\n                        <div class="comment__answers"></div>\n                    </div>\n                </div>\n            ',$("#comment-list").prepend(e)):console.error(n)},o.send(null)}function setCommentsNumber(){var n="http://frontend-test.pingbull.com/pages/"+EMAIL+"/comments?count=99999",e=new XMLHttpRequest;e.open("GET",n,!0),e.onload=function(){var n=JSON.parse(e.responseText);4==e.readyState&&"200"==e.status?$(".comments-number").text(n.length):console.error(n)},e.send(null)}function getCurrentDate(){return formatDate(new Date)}function formatDate(n){var e=n.getDate();e<10&&(e="0"+e);var t=n.getMonth()+1;return t<10&&(t="0"+t),n.getFullYear()+"-"+t+"-"+e}function getCurrentTime(){var n=new Date(Date.now());return n.getHours()-3+":"+(n.getMinutes()+9)}function isFirefox(){return 0<navigator.userAgent.search(/Firefox/)}getCommentsList(),$(".comment_leave").find("img").attr("src",currentUser.avatar),setCommentsNumber(),Array.from||(Array.from=function(){var e=Object.prototype.toString,m=function(n){return"function"==typeof n||"[object Function]"===e.call(n)},a=Math.pow(2,53)-1,c=function(n){var e,t=(e=Number(n),isNaN(e)?0:0!==e&&isFinite(e)?(0<e?1:-1)*Math.floor(Math.abs(e)):e);return Math.min(Math.max(t,0),a)};return function(n){var e=Object(n);if(null==n)throw new TypeError("Array.from requires an array-like object - not null or undefined");var t,a=1<arguments.length?arguments[1]:void 0;if(void 0!==a){if(!m(a))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(t=arguments[2])}for(var o,r=c(e.length),s=m(this)?Object(new this(r)):new Array(r),i=0;i<r;)o=e[i],s[i]=a?void 0===t?a(o,i):a.call(t,o,i):o,i+=1;return s.length=r,s}}());